# GitLab CI/CD Pipeline for Frontend Deployment
# This pipeline builds the React/Vite app and deploys to GitLab Pages
# Updated: Dec 22, 2025

stages:
  - build
  - deploy

variables:
  # Set your Render backend URL here after deployment
  VITE_API_URL: "https://cohort-zzbs.onrender.com/api"

# Build stage - builds the Vite/React application
build:
  stage: build
  image: node:20-alpine
  script:
    - echo "Starting build..."
    - ls -la
    - echo "Checking for index.html..."
    - cat index.html || echo "index.html not found in root"
    - npm ci
    - npm run build
    - echo "Build complete. Contents of dist:"
    - ls -la dist/
    - cat dist/index.html || echo "dist/index.html not found"
  artifacts:
    paths:
      - dist/
    expire_in: 1 week
  only:
    - main
    - master

# Deploy to GitLab Pages
pages:
  stage: deploy
  image: alpine:latest
  script:
    # GitLab Pages requires the files to be in a 'public' directory
    - mv dist public
    # Copy index.html to 404.html for SPA routing (GitLab Pages uses this for client-side routing)
    - cp public/index.html public/404.html
  artifacts:
    paths:
      - public
  only:
    - main
    - master
  dependencies:
    - build
