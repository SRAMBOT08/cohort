# GitLab CI/CD Pipeline for Frontend Deployment
# This pipeline builds the React/Vite app and deploys to GitLab Pages
# Updated: Dec 22, 2025

stages:
  - build
  - deploy

variables:
  # Set your Render backend URL here after deployment
  VITE_API_URL: "https://cohort-zzbs.onrender.com/api"

# Build stage - builds the Vite/React application
build:
  stage: build
  image: node:20-alpine
  script:
    - echo "Starting build..."
    - ls -la
    - echo "Checking for index.html..."
    - cat index.html || echo "index.html not found in root"
    - npm ci
    - npm run build
    - echo "Build complete. Contents of dist:"
    - ls -laR dist/
    - test -f dist/index.html && echo "✅ dist/index.html exists" || echo "❌ dist/index.html missing"
    - cat dist/index.html || echo "dist/index.html not found"
  artifacts:
    paths:
      - dist/
    expire_in: 1 week
    when: always
  only:
    - main
    - master

# Deploy to GitLab Pages
pages:
  stage: deploy
  image: alpine:latest
  script:
    - rm -rf public
    - mv dist public
    - touch public/.nojekyll
    - cp public/index.html public/404.html
    - echo "Final public contents:"
    - ls -laR public/
  artifacts:
    paths:
      - public
  only:
    - main
    - master
  dependencies:
    - build
